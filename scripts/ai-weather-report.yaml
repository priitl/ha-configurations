alias: Generate AI Weather Report
sequence:
  - service: weather.get_forecasts
    data:
      type: hourly
    target:
      entity_id: weather.ilm_lepiksaare
    response_variable: hourly_forecast
  - service: conversation.process
    data:
      agent_id: conversation.openai_conversation
      text: >-
        You are a witty, slightly sarcastic weather forecaster for a smart home dashboard.
        Your task is to provide a brief, multi-sentence forecast for the day in English.
        First, describe the outlook for the day (mentioning the temperature range). Then, follow it up with a funny or sarcastic piece of advice.
        Keep it concise and under 255 characters total. No hashtags.

        Today's Forecast Data:
        - {{ hourly_forecast['weather.ilm_lepiksaare'] }}
    response_variable: ai_weather_report
  - service: input_text.set_value
    target:
      entity_id: input_text.ai_weather_report
    data:
      value: "{{ ai_weather_report.response.speech.plain.speech }}"
mode: single
icon: mdi:weather-sunny-alert
